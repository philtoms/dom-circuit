const t=Symbol(),n="undefined"!=typeof window&&window.document,e=(n,[o,...i])=>i.length?e(n[o],i):n[o]&&n[o][t];export const _CURRENT=Symbol();const o=(i,r,s)=>(c={},u="",f,d,y=[],a=[],b)=>{s||"function"==typeof r||(s=r||[],r=!1);const l=function(t,n,e,o){return e?r(c=t,o):c=void 0===t?c:y.reduce((e,[o,i,r])=>r?i.call(this,e)&&e:o in c&&t[o]===c[o]?e:o===n?t:o in t?i.call(this,e,t[o]):e,c),c=i["t"]?i["t"](c,t):c,r?r(c,o):c},p=(t,[i,p,w])=>{const[,,h,,R]=i.match(/(([\w]+):)?(\s*(.+))?/),[g,j=""]=R.split("@");if("init"===j)return c=p(c),f[d]=c,t;let O=j.startsWith("/")&&e(t,j.slice(1).split("/"));const m=!w&&j.startsWith("/");if(m)O=[],a.push([i,p,O]);else if(O)return w.forEach(t=>O.push(t)),t;const v=g?[].concat(s||n).reduce((t,n)=>{return[...t,...Array.from((e=n,o=g,[".","#",""].reduce((t,n)=>t.length?t:e.querySelectorAll(n+o),[])))];var e,o},[]):s,x=v.length&&h||g.replace(/[#\.\-\[\]\(\)\"\=\^\&]/g,""),C=`${u}/${x}`,E="function"!=typeof p&&o(p,(t,n)=>l({...c,[x]:t},x,!1,n),v)(c[x],C,c,x,O||[],a,m);function N(t){return t===c[x]?t:l.call(this,E?t:p.call(this,c,t===_CURRENT?c[x]:t),x,b,C)}return y.push([x,E?r:N,b]),j&&!j.startsWith("/")&&"state"!==j&&v.forEach(t=>{t.addEventListener(j,N)}),t[h||x]=t=>N(t)[x],E?Object.defineProperty(t,x,{get:()=>E}):t},w=Object.entries(i).reduce(p,{[t]:y});return u?w:Object.defineProperty(a.reduce(p,w),"state",{get:()=>c})};export default o;