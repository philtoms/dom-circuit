const t=Symbol(),e="undefined"!=typeof window&&window.document,n=(e,[o,...i])=>i.length?n(e[o],i):e[o]&&e[o][t];export const _CURRENT=Symbol();const o=(i,s,r)=>(c={},f={id:""},u=[],d=[],a)=>{r||"function"==typeof s||(r=s||[],s=!1);const l=(t,e,n,o)=>void 0===t||e in t&&t[e]===c[e]?c:(c=n?t:u.reduce((n,[o,i,s])=>s?i(n)&&n:o in t?t[o]===c[o]?n:o===e?{...n,[o]:t[e]}:t=i(t[o],!0,t):t,c),c=i["t"]?i["t"](c,t[e]):c,s?s(c,o):c),y=(t,[i,y,b])=>{const[,,p,,g]=i.match(/(([\w]+):)?(\s*(.+))?/),[w,j=""]=g.split("@");if("init"===j)return c=y(c[f.o]),f.state[f.o]=c,t;let m=j.startsWith("/")&&n(t,j.slice(1).split("/"));const R=!b&&j.startsWith("/");if(R)m=[],d.push([i,y,m]);else if(m)return b.forEach(t=>m.push(t)),t;const O=w?[].concat(r||e).reduce((t,e)=>{return[...t,...Array.from((n=e,o=w,[".","#",""].reduce((t,e)=>t.length?t:n.querySelectorAll(e+o),[])))];var n,o},[]):r,h=O.length&&p||w.replace(/[#\.\-\[\]\(\)\"\=\^\&]/g,""),v=`${f.id}/${h}`,x="function"!=typeof y&&o(y,(t,e)=>l(e.endsWith("/")?t:{...c,[h]:t},h,!1,e),O)("object"==typeof c[h]?c[h]:c,{id:v,state:c,o:h},m||[],d,R),C=function(t,e,n=c){t===_CURRENT&&(t=c[h]);const o=h||f.o;return l(x?t:this||!O.length?y.call({i:o,s:this},n,t):O.reduce((e,n)=>y.call({i:o,s:n},e,t),n),h||f.o,a||e,v)};return j&&!j.startsWith("/")&&"state"!==j&&O.forEach(t=>{t.addEventListener(j,C)}),u.push([h||f.o,x?s:C,a]),t[p||h]=t=>C(t)[h],x?Object.defineProperty(t,h,{get:()=>x}):t},b=Object.entries(i).reduce(y,{[t]:u});return f.id?b:Object.defineProperty(d.reduce(y,b),"state",{get:()=>c})};export default o;