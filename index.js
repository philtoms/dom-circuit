const t=Symbol("_REDUCERS"),e=Symbol("_BASE"),n=Symbol("_PROPAGATE"),s=(i,a={})=>{const{t:c,parent:l={id:"",state:()=>g},s:u=[],o:d=[],i:f={},l:b={},u:y}=a;let{state:g={}}=a;const m=(n={},[s,...o])=>s?"."===s[0]?m(".."===s?n[e]:n,o):f[s]?m(f[s],o):o.length?m(n[s],o):[n[t],n[s]]:n[e]?m(n[e],[s,...o]):m(n,o),j=(t,e,n,s,o)=>{if(void 0===t)return g;if(t instanceof Promise)return t.then(t=>j(t,!1,n,s,o)),g;const r=e!==d;if(o)g=d.reduce((e,[,o,r])=>!r&&o(t[n],d,s,e)||e,g);else{g=t;const o=[l.id,n].join("/");r&&(g=d.reduce((t,[r,i,a])=>a&&r&&(s.startsWith(r)||o.startsWith(r))?(i(void 0===t[n]?t:t[n],d,s),g):!r&&"state"!==e&&i(void 0,d,s,t)||t,g))}const i=!e&&d.find(([t,,,e])=>t===n&&e);return y&&r&&y(g,s,!!i||e,!!n),i&&i[1](void 0,!0,s,g),g},v=(i,[c,v,S])=>{const[,,p,,O,P]=c.match(/(([\w]+):)?(\s*([^_]+))?(_)?/),[_,E=""]=O.split("$"),$=/^[\/\.]/.test(E),x="function"!=typeof v&&v,A=x&&Object.keys(x).some(t=>!t.startsWith("$"));if(S){const[t]=m(i,S.split("/"));return t.push([S.replace(/\./g,""),v,d]),i}const R=[].concat(a.mount||[o]).reduce((t,e)=>[...t,...e&&_?r(e,_):[e]],[]),h=_.replace(/[#\.\-\[\]\(\)\"\=\^\&]/g,""),w=h||E?`${l.id}/${h||E}`:l.id||"/",C={id:w,address:h,signal:(t,e)=>m(i,t.split("/"))[1](e),el:R.length<=1?R[0]:R},T=new Proxy(C,{get:(t,e)=>e in b?b[e]:C[e],set:(t,e,n)=>(b[e]=n,!0)}),B=x?s(x,{u:(t,e,n,s)=>j(s?{...g,[h]:t}:t,n,h,e||w),t:i,i:f,g:a.g,state:g[h],parent:{id:w,address:h,state:()=>g,m:A},s:u,mount:R}):{};if("init"===E){const t=v.call(T,g);return t instanceof Promise?t.then(t=>{null!=t&&(g=t,y&&y(g,w,"state",!0))}):null!=t&&(g=t,y&&y(g,w,"state",!0)),i}const D=function(t,e,s,o=(h?g:l.state())){const r=void 0!==t,i=h||l.address;return r||(t=o[i]),r&&t===o[h]?g:(x?B[n]:j)(x?{...o,[i]:t}:R.reduce((e,n)=>(C.el=n,P?((t,e)=>{const n=v.call(T,e);return void 0===n?void 0:n===e?g:{...g,[t]:n}})(i,t):v.call(T,e,t)),o),e,x&&!A?"":h,s||w,A||!h&&l.m&&"state"!==E)};if(!$&&!E||"state"===E){d.push([h,D]);const[t,e]=m(f.root,w.split("/"));"function"==typeof e&&(d.push([h,e,t,!0]),t.push([h,D,d,!0]))}return $&&u.push([c,D,E]),Object.entries(B).forEach(([t,e])=>D[t]=e),D[t]=B[t],D[e]=B[e],"state"!==E&&(i[p||h||E]=D),E&&!$&&"state"!==E&&R.forEach(t=>t&&t.addEventListener(E,D)),f[a.g||"root"]=i,i},S=Object.entries(i).reduce(v,{[t]:d,[e]:c,[n]:j,get state(){return g},g:(t,e={})=>s(t,{...e,i:f,g:e.g||Object.keys(f).length})});return l.id?S:u.reduce(v,S)};export default s;const o=globalThis.document,r=(t,e)=>{const n=[(/[#\.]/.test(e[0])?[""]:[".","#",""]).reduce((n,s)=>n.length?n:t.querySelectorAll(s+e),[])].find(t=>t.length)||o.querySelectorAll(e);return n.length?n:[t]};