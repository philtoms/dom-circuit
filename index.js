const t=Symbol("_REDUCERS"),e=Symbol("_BASE"),n=Symbol("_PROPAGATE"),o=(n={},[s,...i])=>"."===s?o(n,i):".."===s?o(n[e],i):s?i.length?o(n[s],i):[n[t],n[s]]:n[e]?o(n[e],[s,...i]):o(n,i),s=globalThis.document,i=(t,e)=>{const n=[(/[#\.]/.test(e[0])?[""]:[".","#",""]).reduce((n,o)=>n.length?n:t.querySelectorAll(o+e),[])].find(t=>t.length)||s.querySelectorAll(e);return n.length?n:[t]},r=(c,d,u,a={})=>(f={},l={id:"",state:()=>f,t:[s]},b=[],g=[])=>{const m=(t,e,n,o,s)=>{if(t instanceof Promise)return t.then(t=>m(t,e,!1,o,s)),f;if(t===f||e in t&&t[e]===f[e])return t;const i=n!==g;return s?f=g.reduce((n,[,o,s])=>!s&&o(t[e],g,n)||n,f):(f=t,i&&(f=g.reduce((t,[n,s,i])=>i&&o.startsWith(n)?s(void 0===t[e]?t:t[e],g)&&f:!n&&s(void 0,g,t)||t,f))),d&&i&&d(f,o,!!e,n),f},y=(s,[c,u,y])=>{const[,,j,,v]=c.match(/(([\w]+):)?(\s*(.+))?/),[O,S=""]=v.split("$");if(y){const[t]=o(s,S.split("/"));return t.push([S.replace(/\./g,""),u,!0]),s}const E=[].concat(l.t).reduce((t,e)=>[...t,...e&&O?i(e,O):[e]],[]),P=S.startsWith("/")||S.startsWith("."),$="function"!=typeof u,p=$&&Object.keys(u).some(t=>!t.startsWith("$")),A=O.replace(/[#\.\-\[\]\(\)\"\=\^\&]/g,""),R=(A||S?`${l.id}/${A||S}`:l.id||"/").replace("//","/");A&&"object"==typeof f&&!(A in f)&&(f[A]=$?{}:void 0);const _=$?r(u,(t,e,n,o)=>f=m(n?{...f,[A]:t}:t,A,o,e),s)(f[A]||f,{id:R,o:A,state:()=>f,t:E},b):{},w={id:R,o:A,s:(t,e)=>o(s,t.split("/"))[1](e),i:E.length<=1?E[0]:E},x=new Proxy(w,{get:(t,e)=>e in a?a[e]:w[e],set:(t,e,n)=>(a[e]=n,!0)});if("init"===S){const t=u.call(x,A?f:l.state());if(!A)return void 0!==t&&(f=t,d&&d(f,R)),s;t&&(f[A]=t[A])}const T=function(t,e,o=(A?f:l.state())){const s=A||l.o;return void 0===t&&(t=o[s]),($?_[n]:m)($?{...o,[s]:t}:E.reduce((e,n)=>(w.i=n,u.call(x,e,t)||e),o),$&&!p?"":A,e,R,p)};return(P||S)&&"state"!==S||g.push([A,T]),P&&b.push([c,T,!0]),Object.entries(_).forEach(([t,e])=>T[t]=e),T[t]=_[t],T[e]=_[e],s[j||A||S]=T,S&&!P&&"state"!==S&&E.forEach(t=>t&&t.addEventListener(S,T)),s},j=Object.entries(c).reduce(y,{[t]:g,[e]:u,[n]:m});return l.id?j:Object.defineProperty(b.reduce(y,j),"state",{get:()=>f})};export default r;