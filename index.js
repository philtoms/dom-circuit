const t=Symbol("_REDUCERS"),e=Symbol("_BASE"),n=Symbol("_PROPAGATE"),o=(n={},[s,...i])=>"."===s?o(n,i):".."===s?o(n[e],i):s?i.length?o(n[s],i):[n[t],n[s]]:n[e]?o(n[e],[s,...i]):o(n,i),s=globalThis.document,i=(t,e)=>{const n=[(/[#\.]/.test(e[0])?[""]:[".","#",""]).reduce((n,o)=>n.length?n:t.querySelectorAll(o+e),[])].find(t=>t.length)||s.querySelectorAll(e);return n.length?n:[t]},r=(c,a)=>(d={},u={t:null,id:"",state:()=>d,o:[s]},l=[],b=[],f={})=>{const g=(t,e,n,o,s)=>{if(t instanceof Promise)return t.then(t=>g(t,e,!1,o,s)),d;if(t===d||e in t&&t[e]===d[e])return t;const i=n!==b;return s?d=b.reduce((n,[,o,s])=>!s&&o(t[e],b,n)||n,d):(d=t,i&&(d=b.reduce((t,[n,s,i])=>i&&o.startsWith(n)?s(void 0===t[e]?t:t[e],b)&&d:!n&&s(void 0,b,t)||t,d))),a&&i&&a(d,o,!!e,n),d},m=(s,[c,m,y])=>{const[,,j,,v,O]=c.match(/(([\w]+):)?(\s*([^_]+))?(_)?/),[S,_=""]=v.split("$");if(y){const[t]=o(s,_.split("/"));return t.push([_.replace(/\./g,""),m,!0]),s}const E=[].concat(u.o).reduce((t,e)=>[...t,...e&&S?i(e,S):[e]],[]),P=/^[\/\.]/.test(_),$="function"!=typeof m,p=$&&Object.keys(m).some(t=>!t.startsWith("$")),A=S.replace(/[#\.\-\[\]\(\)\"\=\^\&]/g,""),R=(A||_?`${u.id}/${A||_}`:u.id||"/").replace("//","/");A&&"object"==typeof d&&!(A in d)&&(d[A]=$?{}:void 0);const w=$?r(m,(t,e,n,o)=>d=g(n?{...d,[A]:t}:t,A,o,e))(d[A]||d,{t:s,id:R,s:A,state:()=>d,o:E},l):{},x={id:R,s:A,i:(t,e)=>o(s,t.split("/"))[1](e),u:E.length<=1?E[0]:E},T=new Proxy(x,{get:(t,e)=>e in f?f[e]:x[e],set:(t,e,n)=>(f[e]=n,!0)});if("init"===_){const t=m.call(T,A?d:u.state());if(!A)return void 0!==t&&(d=t,a&&a(d,R)),s;t&&(d[A]=t[A])}const h=function(t,e,o=(A?d:u.state())){const s=A||u.s;return void 0===t&&(t=o[s]),($?w[n]:g)($?{...o,[s]:t}:E.reduce((e,n)=>(x.u=n,O?{...e,[s]:m.call(T,t)||e[s]}:m.call(T,e,t)||e),o),$&&!p?"":A,e,R,p)};return(P||_)&&"state"!==_||b.push([A,h]),P&&l.push([c,h,!0]),Object.entries(w).forEach(([t,e])=>h[t]=e),h[t]=w[t],h[e]=w[e],s[j||A||_]=h,_&&!P&&"state"!==_&&E.forEach(t=>t&&t.addEventListener(_,h)),s},y=Object.entries(c).reduce(m,{[t]:b,[e]:u.t,[n]:g});return u.id?y:Object.defineProperty(l.reduce(m,y),"state",{get:()=>d})};export default r;