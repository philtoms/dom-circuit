const t=Symbol(),n="undefined"!=typeof window&&window.document,e=(n,[o,...i])=>i.length?e(n[o],i):n[o]&&n[o][t];export const _CURRENT=Symbol();const o=(i,r,c)=>(s,u="",f=[],d=[],y)=>{c||"function"==typeof r||(c=r||[],r=!1);const b=function(t,n,e,o){return e?r(s=t,o):s=void 0===t?s:f.reduce((e,[o,i,r])=>r?i.call(this,e)&&e:o in s&&t[o]===s[o]?e:o===n?t:o in t?i.call(this,e,t[o]):e,s),r?r(s,o):s},l=(t,[i,l,p])=>{const[w,a,h,R,g]=i.match(/(([\w]+):)?(\s*(.+))?/),[j,O]=g.split("@"),m=!(j in s)&&h||j.replace(/[#\.\-\[\]\(\)\"\=\^\&\/]/g,""),v=`${u}/${m}`;let x=j.startsWith("/")&&e(t,j.slice(1).split("/"));const C=!p&&j.startsWith("/");if(C)x=[],d.push([i,l,x]);else if(x)return p.forEach(t=>x.push(t)),t;const E=j?[].concat(c||n).reduce((t,n)=>{return[...t,...Array.from((e=n,o=j,[".","#",""].reduce((t,n)=>t.length?t:e.querySelectorAll(n+o),[])))];var e,o},[]):c,N="function"!=typeof l&&o(l,(t,n)=>b({...s,[m]:t},m,!1,n),E)(s[m]||{},v,x||[],d,C);function S(t){return t===s[m]?t:b.call(this,N?t:l.call(this,s,t===_CURRENT?s[m]:t),m,y,v)}return f.push([m,N?r:S,y]),O&&E.forEach(t=>{t.addEventListener(O,S)}),t[h||m]=t=>S(t)[m],N?Object.defineProperty(t,m,{get:()=>N}):t},p=Object.entries(i).reduce(l,{[t]:f});return u?p:Object.defineProperty(d.reduce(l,p),"state",{get:()=>s})};export default o;